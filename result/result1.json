import Creatomate from 'creatomate';
import fs from 'fs';

// 1. result1.json 읽기
const scenes = JSON.parse(fs.readFileSync('result/result1.json', 'utf-8'));

// 2. Creatomate elements 생성
const elements = [];

// (1) 배경 영상 전체 (result.mp4는 Creatomate에서 접근 가능한 URL이어야 함)
elements.push(new Creatomate.Video({
  source: 'https://your-server.com/result.mp4', // 또는 S3 등 외부 URL
  start: 0,
  length: 18 * 3.5 // 전체 길이
}));

// (2) 씬별 자막/음성
for (let i = 1; i <= 18; i++) {
  const sceneKey = `scene_${i}`;
  const scene = scenes[sceneKey];
  const start = (i - 1) * 3.5;

  // 자막
  elements.push(new Creatomate.Text({
    text: scene.script,
    start,
    length: 3.5,
    // 스타일, 위치 등 추가 가능
  }));

  // 음성 (씬별 mp3 파일명: scene_1.mp3, scene_2.mp3, ...)
  elements.push(new Creatomate.Audio({
    source: `https://your-server.com/audio/scene_${i}.mp3`, // 씬별 음성 mp3 URL
    start,
    length: 3.5
  }));

  // (선택) 이미지 오버레이도 추가하고 싶다면
  // elements.push(new Creatomate.Image({
  //   source: `https://your-server.com/images/scene_${i}.png`,
  //   start,
  //   length: 3.5
  // }));
}

// 3. Creatomate 렌더링 요청
const client = new Creatomate.Client('YOUR_API_KEY');
const source = new Creatomate.Source({
  outputFormat: 'mp4',
  width: 1280,
  height: 720,
  elements
});

client.render({ source })
  .then((renders) => console.log('Your video is ready:', renders));